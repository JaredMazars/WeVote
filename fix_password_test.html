<!DOCTYPE html>
<html>
<head>
    <title>Super Admin Test Suite</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { border: 1px solid #ccc; margin: 10px 0; padding: 15px; border-radius: 5px; }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        button { padding: 10px 15px; margin: 5px; background: #007cba; color: white; border: none; border-radius: 3px; cursor: pointer; }
        button:hover { background: #005a87; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 3px; }
        input { padding: 8px; margin: 5px; border: 1px solid #ccc; border-radius: 3px; width: 200px; }
    </style>
</head>
<body>
    <h1>üîß Super Admin Test Suite</h1>

    <div class="test-section">
        <h2>1. Fix Super Admin Password</h2>
        <p>This will update the super admin password hash to work with "SuperAdmin123!"</p>
        <button id="fixPassword">Fix Password Hash</button>
        <div id="fixResult"></div>
    </div>

    <div class="test-section">
        <h2>2. Test Super Admin Login</h2>
        <p>Test the super admin login directly</p>
        <input type="email" id="email" value="superadmin@wevote.com" placeholder="Email">
        <input type="password" id="password" value="SuperAdmin123!" placeholder="Password">
        <button id="testLogin">Test Login</button>
        <div id="loginResult"></div>
    </div>

    <div class="test-section">
        <h2>3. Check User Roles</h2>
        <p>Check the current roles for both admin users</p>
        <button id="checkRoles">Check User Roles</button>
        <div id="rolesResult"></div>
    </div>

    <div class="test-section">
        <h2>4. Fix Admin User Role</h2>
        <p>Update jaredmoodley1212@gmail.com to be a Super Admin (role_id = 0)</p>
        <button id="fixUserRole">Fix User Role</button>
        <div id="fixRoleResult"></div>
    </div>

    <div class="test-section">
        <h2>5. Check Super Admin User</h2>
        <p>Verify the super admin user exists in the database</p>
        <button id="checkUser">Check User</button>
        <div id="userResult"></div>
    </div>

    <script>
        // Fix Password
        document.getElementById('fixPassword').addEventListener('click', async () => {
            document.getElementById('fixResult').innerHTML = '<p class="info">Fixing password...</p>';
            try {
                const response = await fetch('http://localhost:3001/api/superadmin/fix-password', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const result = await response.json();
                document.getElementById('fixResult').innerHTML = `
                    <h3>Password Fix Result:</h3>
                    <p class="${response.ok ? 'success' : 'error'}">Status: ${response.status}</p>
                    <pre>${JSON.stringify(result, null, 2)}</pre>
                `;
            } catch (error) {
                document.getElementById('fixResult').innerHTML = `
                    <h3 class="error">Error:</h3>
                    <p class="error">${error.message}</p>
                `;
            }
        });

        // Check Roles
        document.getElementById('checkRoles').addEventListener('click', async () => {
            document.getElementById('rolesResult').innerHTML = '<p class="info">Checking roles...</p>';
            try {
                const response = await fetch('http://localhost:3001/api/superadmin/check-roles');
                const result = await response.json();
                
                document.getElementById('rolesResult').innerHTML = `
                    <h3>User Roles Result:</h3>
                    <p class="${response.ok ? 'success' : 'error'}">Status: ${response.status}</p>
                    <h4>Users:</h4>
                    <pre>${JSON.stringify(result.users, null, 2)}</pre>
                    <h4>Available Roles:</h4>
                    <pre>${JSON.stringify(result.roles, null, 2)}</pre>
                `;
            } catch (error) {
                document.getElementById('rolesResult').innerHTML = `
                    <h3 class="error">Error:</h3>
                    <p class="error">${error.message}</p>
                `;
            }
        });

        // Fix User Role
        document.getElementById('fixUserRole').addEventListener('click', async () => {
            document.getElementById('fixRoleResult').innerHTML = '<p class="info">Fixing user role...</p>';
            try {
                const response = await fetch('http://localhost:3001/api/superadmin/fix-user-role', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const result = await response.json();
                document.getElementById('fixRoleResult').innerHTML = `
                    <h3>Fix User Role Result:</h3>
                    <p class="${response.ok ? 'success' : 'error'}">Status: ${response.status} ${response.ok ? '‚úÖ' : '‚ùå'}</p>
                    <pre>${JSON.stringify(result, null, 2)}</pre>
                `;
                
                if (response.ok) {
                    document.getElementById('fixRoleResult').innerHTML += `
                        <p class="success"><strong>üéâ USER ROLE UPDATED!</strong></p>
                        <p>jaredmoodley1212@gmail.com is now a Super Admin.</p>
                    `;
                }
            } catch (error) {
                document.getElementById('fixRoleResult').innerHTML = `
                    <h3 class="error">Error:</h3>
                    <p class="error">${error.message}</p>
                `;
            }
        });

        // Test Login
        document.getElementById('testLogin').addEventListener('click', async () => {
            document.getElementById('loginResult').innerHTML = '<p class="info">Testing login...</p>';
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            try {
                const response = await fetch('http://localhost:3001/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email, password })
                });
                
                const result = await response.json();
                document.getElementById('loginResult').innerHTML = `
                    <h3>Login Test Result:</h3>
                    <p class="${response.ok ? 'success' : 'error'}">Status: ${response.status} ${response.ok ? '‚úÖ' : '‚ùå'}</p>
                    <pre>${JSON.stringify(result, null, 2)}</pre>
                `;
                
                if (response.ok && result.token) {
                    document.getElementById('loginResult').innerHTML += `
                        <p class="success"><strong>üéâ LOGIN SUCCESSFUL!</strong></p>
                        <p>You can now use these credentials to access the Super Users section.</p>
                    `;
                }
            } catch (error) {
                document.getElementById('loginResult').innerHTML = `
                    <h3 class="error">Login Error:</h3>
                    <p class="error">${error.message}</p>
                `;
            }
        });

        // Check User
        document.getElementById('checkUser').addEventListener('click', async () => {
            document.getElementById('userResult').innerHTML = '<p class="info">Checking user...</p>';
            try {
                // This will show all users including super admin
                const response = await fetch('http://localhost:3001/api/admin/users');
                const result = await response.json();
                
                // Find super admin in the results
                const users = Array.isArray(result) ? result : [];
                const superAdmin = users.find(user => user.email === 'superadmin@wevote.com');
                
                if (superAdmin) {
                    document.getElementById('userResult').innerHTML = `
                        <h3>Super Admin User Found:</h3>
                        <p class="success">‚úÖ Super admin exists in database</p>
                        <pre>${JSON.stringify(superAdmin, null, 2)}</pre>
                    `;
                } else {
                    document.getElementById('userResult').innerHTML = `
                        <h3 class="error">Super Admin Not Found:</h3>
                        <p class="error">‚ùå Could not find super admin user</p>
                        <p>Total users found: ${users.length}</p>
                    `;
                }
            } catch (error) {
                document.getElementById('userResult').innerHTML = `
                    <h3 class="error">Error:</h3>
                    <p class="error">${error.message}</p>
                `;
            }
        });

        // Auto-run check roles on page load
        window.addEventListener('load', () => {
            document.getElementById('checkRoles').click();
        });
    </script>
</body>
</html>
